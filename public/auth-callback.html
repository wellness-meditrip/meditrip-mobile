<!doctype html>
<html>
  <head>
    <title>인증 처리 중...</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f5f5f5;
      }
      .container {
        text-align: center;
        padding: 20px;
      }
      .loading {
        color: #666;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="loading">인증 처리 중...</div>
    </div>
    <script>
      // URL 파라미터에서 인증 코드 추출
      const urlParams = new URLSearchParams(window.location.search);
      const code = urlParams.get('code');
      const state = urlParams.get('state');

      console.log('OAuth callback received:', { code, state });

      if (code) {
        // 앱 딥링크로 리디렉션 (올바른 스키마 사용)
        const deepLink = `meditrip-mobile://auth?code=${code}&state=${state || ''}`;
        console.log('Redirecting to:', deepLink);

        // 딥링크로 리디렉션 시도
        try {
          window.location.href = deepLink;

          // 3초 후에도 앱이 열리지 않으면 브라우저 닫기 시도
          setTimeout(() => {
            window.close();
          }, 3000);
        } catch (error) {
          console.error('Deep link failed:', error);
          window.close();
        }
      } else {
        // 인증 코드가 없으면 에러 처리
        console.error('No code received');
        window.location.href = 'meditrip-mobile://auth?error=no_code';

        // 3초 후 브라우저 닫기
        setTimeout(() => {
          window.close();
        }, 3000);
      }
    </script>
  </body>
</html>
